---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Анализ текста

```{r, message=FALSE}
library(tidyverse)
```

## Данные

Для работы мы воспользуемся двумя датасетами:

* Рассказыв М. Зощенко

```{r,message=FALSE}
zo <- read_csv("https://raw.githubusercontent.com/agricolamz/2020_HSE_DPO/master/data/zoshenko.csv")
zo
```

* [Курс начертательной геометрии под редакцией В.Гордона](https://raw.githubusercontent.com/agricolamz/2020_HSE_DPO/master/data/gordon_geometry.csv)

```{r,message=FALSE}
geom <- read_csv("https://raw.githubusercontent.com/agricolamz/2020_HSE_DPO/master/data/gordon_geometry.csv")
```

Для начала лемматизируем полуичвшиеся тексты:

```{r, cache=TRUE}
library(udpipe)
rus <- udpipe_load_model("russian-syntagrus-ud-2.4-190531.udpipe")
geom_tokenized <- udpipe(geom, object = rus)
zo_tokenized <- udpipe(zo, object = rus)
```

Уберем стопслова и леммы, содержащие цифры и знаки препинания

```{r}
library(stopwords)
sw <- tibble(lemma = stopwords(language = "ru"))

geom_tokenized %>% 
  bind_rows(zo_tokenized) %>% 
  filter(!str_detect(lemma, "\\W|\\d")) %>% 
  anti_join(sw) %>% 
  select(doc_id, sentence_id, lemma) ->
  all_texts
all_texts
```

## Генерация текста

## Анализ тональности

* [Linis Crowd](http://linis-crowd.org/)
    * лемма
    * значение
    * среднеквадратичное отклонение
* [РуСентиЛекс](http://www.labinform.ru/pub/rusentilex/index.htm):
    * слово или словосочетание,
    * часть речи или синтаксический тип группы,
    * слово или словосочетание в лемматизированной форме, 
    * тональность: позитивная (positive), негативная(negative), нейтральная (neutral) или неопределеная оценка, зависит от контекста (positive/negative),
    * источник: оценка (opinion), чувство (feeling), факт (fact),
    * если тональность отличается для разных значений многозначного слова, то перечисляются все значения слова по тезаурусу РуТез и дается отсылка на сооветствующее понятие - имя понятия в кавычках.

Мы будем использовать [датасет](https://raw.githubusercontent.com/agricolamz/2020_HSE_DPO/master/data/ru_sentiment_linis-crowd.csv), составленный на базе Linis Crowd

```{r}
ru_sentiments <- read_csv("https://raw.githubusercontent.com/agricolamz/2020_HSE_DPO/master/data/ru_sentiment_linis-crowd.csv")

all_texts %>% 
  group_by(doc_id) %>% 
  left_join(ru_sentiments, by = c("lemma" = "words")) %>% 
  mutate(value = ifelse(is.na(value), 0, value)) %>% 
  group_by(doc_id, sentence_id) %>% 
  summarise(value = sum(value))
  
  
```


## Тематическое моделирование

