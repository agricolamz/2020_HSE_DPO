[
["анализ-текста.html", "4 Анализ текста 4.1 Данные 4.2 Tf-idf 4.3 Генерация текста 4.4 Анализ тональности 4.5 Тематическое моделирование", " 4 Анализ текста library(tidyverse) theme_set(theme_bw()) 4.1 Данные Для работы мы воспользуемся двумя датасетами: Рассказы М. Зощенко zo &lt;- read_csv(&quot;https://raw.githubusercontent.com/agricolamz/2020_HSE_DPO/master/data/zoshenko.csv&quot;) zo Курс начертательной геометрии под редакцией В.Гордона geom &lt;- read_csv(&quot;https://raw.githubusercontent.com/agricolamz/2020_HSE_DPO/master/data/gordon_geometry.csv&quot;) Для начала лемматизируем полуичвшиеся тексты: library(udpipe) rus &lt;- udpipe_load_model(&quot;russian-syntagrus-ud-2.4-190531.udpipe&quot;) geom_tokenized &lt;- udpipe(geom, object = rus) zo_tokenized &lt;- udpipe(zo, object = rus) Уберем стопслова и леммы, содержащие цифры и знаки препинания library(stopwords) sw &lt;- tibble(lemma = stopwords(language = &quot;ru&quot;)) geom_tokenized %&gt;% bind_rows(zo_tokenized) %&gt;% filter(!str_detect(lemma, &quot;\\\\W|\\\\d&quot;)) %&gt;% anti_join(sw) %&gt;% select(doc_id, sentence_id, lemma) -&gt; all_texts ## Joining, by = &quot;lemma&quot; all_texts 4.2 Tf-idf library(tidytext) all_texts %&gt;% count(doc_id, lemma) %&gt;% bind_tf_idf(lemma, doc_id, n) %&gt;% arrange(tf_idf) %&gt;% group_by(doc_id) %&gt;% top_n(5) %&gt;% ungroup() %&gt;% mutate(lemma = reorder_within(lemma, tf_idf, doc_id)) %&gt;% ggplot(aes(tf_idf, lemma))+ geom_col()+ facet_wrap(~doc_id, scales = &quot;free&quot;)+ scale_y_reordered() ## Selecting by tf_idf 4.3 Генерация текста 4.4 Анализ тональности Linis Crowd лемма значение среднеквадратичное отклонение РуСентиЛекс: слово или словосочетание, часть речи или синтаксический тип группы, слово или словосочетание в лемматизированной форме, тональность: позитивная (positive), негативная(negative), нейтральная (neutral) или неопределеная оценка, зависит от контекста (positive/negative), источник: оценка (opinion), чувство (feeling), факт (fact), если тональность отличается для разных значений многозначного слова, то перечисляются все значения слова по тезаурусу РуТез и дается отсылка на сооветствующее понятие - имя понятия в кавычках. Мы будем использовать датасет, составленный на базе Linis Crowd ru_sentiments &lt;- read_csv(&quot;https://raw.githubusercontent.com/agricolamz/2020_HSE_DPO/master/data/ru_sentiment_linis-crowd.csv&quot;) ## Parsed with column specification: ## cols( ## words = col_character(), ## value = col_double() ## ) all_texts %&gt;% group_by(doc_id) %&gt;% left_join(ru_sentiments, by = c(&quot;lemma&quot; = &quot;words&quot;)) %&gt;% mutate(value = ifelse(is.na(value), 0, value)) %&gt;% group_by(doc_id, sentence_id) %&gt;% summarise(value = sum(value)) %&gt;% mutate(color = ifelse(value &gt;= 0, &quot;positive&quot;, &quot;negative&quot;)) %&gt;% ggplot(aes(sentence_id, value, fill = color))+ geom_col()+ facet_wrap(~doc_id, scales = &quot;free&quot;) 4.5 Тематическое моделирование library(topicmodels) all_texts %&gt;% count(doc_id, lemma, sort = TRUE) %&gt;% cast_dtm(doc_id, lemma, n) %&gt;% LDA(k = 2, control = list(seed = 42)) -&gt; lda lda %&gt;% tidy(matrix = &quot;beta&quot;) %&gt;% group_by(topic) %&gt;% top_n(15, beta) %&gt;% ungroup() %&gt;% arrange(topic, -beta) %&gt;% mutate(term = reorder_within(term, beta, topic)) %&gt;% ggplot(aes(term, beta, fill = factor(topic))) + geom_col(show.legend = FALSE) + facet_wrap(~ topic, scales = &quot;free&quot;) + coord_flip() + scale_x_reordered() lda %&gt;% tidy(matrix = &quot;beta&quot;) %&gt;% mutate(topic = paste0(&quot;topic&quot;, topic)) %&gt;% spread(topic, beta) %&gt;% filter(topic1 &gt; .006 | topic2 &gt; .002) %&gt;% mutate(log_ratio = log2(topic2 / topic1), term = fct_reorder(term, log_ratio)) %&gt;% ggplot(aes(log_ratio, term))+ geom_col() lda %&gt;% tidy(matrix = &quot;gamma&quot;) "]
]
